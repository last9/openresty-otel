server {
    listen      9145;
    server_name _;

    # Prometheus metrics endpoint — scraped by OTel Collector
    location /metrics {
        content_by_lua_block {
            require("metrics_init").collect()
        }
    }

    # nginx stub_status — scraped by OTel Collector nginx receiver
    location /nginx_status {
        stub_status on;
        access_log  off;

        # Allow only localhost and common Docker bridge networks
        allow 127.0.0.1;
        allow ::1;
        allow 172.0.0.0/8;
        allow 10.0.0.0/8;
        allow 192.168.0.0/16;
        deny all;
    }
}
